<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OpenAI Operator Image Dashboard</title>
    <style>
      body {
        font-family: 'Arial', sans-serif;
        background-color: #f9f9f9;
        color: #333;
        padding: 20px;
        max-width: 1200px;
        margin: auto;
      }
      header {
        background-color: #004aad;
        color: white;
        padding: 10px 20px;
        text-align: center;
        border-radius: 8px;
      }
      .instruction-box {
        padding: 15px;
        background: #f1f1f1;
        border-radius: 8px;
        margin: 20px 0;
      }
      .image-browser {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin-top: 20px;
      }
      .image-preview {
        margin-top: 20px;
        text-align: center;
      }
      .dropdown {
        margin: 10px 0;
      }
      select {
        padding: 10px;
        margin-right: 10px;
        border-radius: 4px;
        border: 1px solid #ccc;
      }
      .image-list a {
        display: block;
        color: #004aad;
        text-decoration: none;
        margin: 5px 0;
      }
      .image-list a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>OpenAI Operator Image Dashboard</h1>
    </header>

    <section class="instruction-box">
      <h2>Instructions for OpenAI Operator</h2>
      <p>
        1. Log in using your Google account to access the image data.
      </p>
      <p>
        2. Use the dropdown menus to select the device, year, month, day, and hour.
        This will list all available images for the selected time period.
      </p>
      <p>
        3. Click on any image link to preview it directly in the browser.
      </p>
    </section>

    <section class="image-browser">
      <h2>Image Browser</h2>
      <div class="dropdown">
        <label for="device-select">Device ID:</label>
        <select id="device-select"></select>

        <label for="year-select">Year:</label>
        <select id="year-select"></select>

        <label for="month-select">Month:</label>
        <select id="month-select"></select>

        <label for="day-select">Day:</label>
        <select id="day-select"></select>

        <label for="hour-select">Hour:</label>
        <select id="hour-select"></select>
      </div>

      <div class="image-list" id="image-list"></div>

      <div class="image-preview" id="image-preview">
        <h3>Selected Image Preview</h3>
        <img id="preview-img" src="" alt="No image selected" style="max-width: 100%; border: 1px solid #ccc;" />
      </div>
    </section>

    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.814.0.min.js"></script>

    <script>
      const bucketUrl = "https://images-947384912039.s3.amazonaws.com/images/";
      const identityPoolId = "us-east-1:057eb5c9-a520-4373-80c6-7d43fe3673cb";
      const region = "us-east-1";
      const bucketName = "images-947384912039";

      AWS.config.region = region;
      AWS.config.credentials = new AWS.CognitoIdentityCredentials({
        IdentityPoolId: identityPoolId,
      });

      // Dropdown elements
      const deviceSelect = document.getElementById("device-select");
      const yearSelect = document.getElementById("year-select");
      const monthSelect = document.getElementById("month-select");
      const daySelect = document.getElementById("day-select");
      const hourSelect = document.getElementById("hour-select");
      const imageList = document.getElementById("image-list");
      const previewImg = document.getElementById("preview-img");

      function populateDropdown(dropdown, values) {
        dropdown.innerHTML = "<option value=''>Select</option>";
        values.forEach((value) => {
          const option = document.createElement("option");
          option.value = value;
          option.textContent = value;
          dropdown.appendChild(option);
        });
      }

      function fetchAndListImages() {
        // Dummy sample data; replace with S3 listing logic.
        const sampleImages = [
          "2025/02/05/01/image_2025-02-05T01-31-15-288Z.png",
          "2025/02/05/01/image_2025-02-05T01-35-20-500Z.png",
        ];

        imageList.innerHTML = "";
        sampleImages.forEach((path) => {
          const imgUrl = `${bucketUrl}${path}`;
          const link = document.createElement("a");
          link.href = "#";
          link.textContent = path;
          link.addEventListener("click", () => {
            previewImg.src = imgUrl;
          });
          imageList.appendChild(link);
        });
      }

      // Populate dropdowns with sample data
      populateDropdown(deviceSelect, ["device1", "device2"]);
      populateDropdown(yearSelect, ["2025"]);
      populateDropdown(monthSelect, ["01", "02"]);
      populateDropdown(daySelect, ["05"]);
      populateDropdown(hourSelect, ["01", "02"]);

      // Fetch images when dropdowns are selected (simulated here)
      deviceSelect.addEventListener("change", fetchAndListImages);

      // Initialize Google Sign-In
      function initGoogleSignIn() {
        gapi.load('auth2', function() {
          const auth2 = gapi.auth2.init({
            client_id: '859878185380-o0g59tkq13jm1dhqbt4eb4a4bmgqgjsr.apps.googleusercontent.com',
          });

          auth2.isSignedIn.listen(function(isSignedIn) {
            if (isSignedIn) {
              const user = auth2.currentUser.get().getBasicProfile();
              alert(`Welcome, ${user.getName()}! You are now signed in.`);
            } else {
              alert("Please sign in to access the images.");
            }
          });

          document.body.insertAdjacentHTML(
            'beforeend',
            '<div class="g-signin2" data-onsuccess="onSignIn"></div>'
          );
        });
      }

      initGoogleSignIn();
    </script>
  </body>
</html>
