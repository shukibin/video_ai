<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
    <meta http-equiv="Cross-Origin-Resource-Policy" content="same-origin">
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
    <title>Viewer App</title>

    <!-- AWS SDK -->
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1319.0.min.js"></script>

    <!-- Google OAuth SDK -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <script>
        // Initialize Google OAuth once the script is loaded
        function initializeGoogleOAuth() {
            google.accounts.id.initialize({
                client_id: 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com', // Replace with the correct Google OAuth Client ID
                callback: handleCredentialResponse
            });

            google.accounts.id.renderButton(
                document.getElementById('google-signin'),
                { theme: 'outline', size: 'large' }
            );
        }

        // Handle the Credential Response from Google
        function handleCredentialResponse(response) {
            console.log("Credential response received:", response);

            // Extract the ID token from the response
            const idToken = response.credential;

            // Initialize AWS SDK with Google credentials
            AWS.config.update({
                region: 'us-east-1', // Your AWS region
                credentials: new AWS.CognitoIdentityCredentials({
                    IdentityPoolId: 'us-east-1:9677a92e-d3ff-49f0-ae95-bbb80a90f43a', // Your AWS Cognito Identity Pool ID
                    Logins: {
                        'accounts.google.com': idToken // Use the Google login token for authentication
                    }
                })
            });

            // Get AWS credentials using the Cognito Identity Pool
            AWS.config.credentials.get(function() {
                if (AWS.config.credentials) {
                    console.log("Successfully authenticated with AWS");
                    loadImageDropdowns();  // Proceed with the next steps (e.g., load S3 data)
                } else {
                    console.error("Failed to authenticate with AWS");
                }
            });

            // Hide the sign-in section and show the image browser
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('image-browser').style.display = 'block';
        }

        // Load S3 Image Dropdowns (You can replace this with your actual code to load images)
        function loadImageDropdowns() {
            console.log('Loading image dropdowns from S3...');
            // Make sure you add the appropriate code to interact with AWS services (like S3)
        }
    </script>

</head>
<body>

    <div id="auth-section">
        <div id="signin-status">Please sign in with Google.</div>
        <div id="google-signin"></div>
    </div>

    <div id="image-browser" style="display:none;">
        <h1>Welcome, you are signed in!</h1>
        <button onclick="loadImageDropdowns()">Load S3 Images</button>
    </div>

</body>
</html>
